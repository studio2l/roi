{{template "head.bml"}}
{{template "nav.bml" $}}
<div class="ui raised very padded text container grey inverted segment">
	{{with $t := $.Task}}
	<h2 class="ui header">태스크 수정</h2>
	<h3 class="ui dividing header" style="color:#818181">
		<a href="/update-show?id={{$t.Show}}" style="color:#9f9f9f">{{$t.Show}}</a> /
		{{$t.Category}} /
		<a href="/update-shot?id={{$t.Show}}/{{$t.Category}}/{{$t.Unit}}" style="color:#9f9f9f">{{$t.Unit}}</a> /
		<span style="color:#ccc">{{$t.Task}}</span>
	</h3>
	<form method="post" class="ui form">
		<input hidden type="text" name="id" value="{{$t.ID}}"/>
		<div class="field"><label>마감일</label>
			<input type="date" name="due_date" value="{{stringFromDate $t.DueDate}}">
		</div>
		<div class="field"><label>상태</label>
			<select type="text" name="status">
				{{range $ts := $.AllTaskStatus}}
				<option value="{{$ts}}" {{if eq $ts $t.Status}}selected{{end}}>{{$ts.UIString}}</option>
				{{end}}
			</select>
		</div>
		<div class="field"><label>담당</label>
			<div class="autocomplete" style="display:grid;grid-template-columns:1fr">
			<input id="autocomplete-user" type="text" name="assignee" value="{{$t.Assignee}}"/>
			</div>
		</div>
		<div class="field"><label>퍼블리시된 버전</label>
			<input type="text" name="publish_version" value="{{$t.PublishVersion}}">
		</div>
		<div class="field"><label>승인된 버전</label>
			<input type="text" name="approved_version" value="{{$t.ApprovedVersion}}">
		</div>
		<div class="field"><label>리뷰가 필요한 버전</label>
			<input type="text" name="review_versions" placeholder="version, version" value="{{fieldJoin $t.ReviewVersions}}">
		</div>
		<div class="field"><label>진행중인 버전</label>
			<input type="text" name="working_version" value="{{$t.WorkingVersion}}">
		</div>
		<button class="ui button green" type="submit" value="Submit">수정</button>
		<div style="height:2rem;"></div>
	</form>
	<h2 class="ui dividing header">
		버전
		<a href="/add-version?id={{$t.ID}}" class="ui right floated mini basic inverted button">추가</a>
	</h2>
	<div class="ui container">
		{{range $v := $.Versions}}
		<a href="/update-version?id={{$v.ID}}" class="ui label">{{$v.Version}}</a>
		{{end}}
	</div>
	{{end}}
</div>

<script>
let userName = {
	{{range $u := $.Users -}}
	"{{$u.ID}}": {{$u.Name}},
	{{end}}
}

let users = [
	{{range $u := $.Users -}}
	"{{$u.ID}}",
	{{end}}
]
users.sort()

autocomplete(document.getElementById("autocomplete-user"), users, userName)
</script>
{{template "footer.bml"}}
